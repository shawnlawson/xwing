(function(){var t,n,i,e,s,a,o=[].slice,r=[].indexOf||function(t){for(var n=0,i=this.length;i>n;n++)if(n in this&&this[n]===t)return n;return-1},l=function(t,n){return function(){return t.apply(n,arguments)}},d={}.hasOwnProperty,u=function(t,n){function i(){this.constructor=t}for(var e in n)d.call(n,e)&&(t[e]=n[e]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};window.iced={Deferrals:function(){function t(t){this.continuation=t,this.count=1,this.ret=null}return t.prototype._fulfill=function(){return--this.count?void 0:this.continuation(this.ret)},t.prototype.defer=function(t){return++this.count,function(n){return function(){var i,e;return i=1<=arguments.length?o.call(arguments,0):[],null!=t&&null!=(e=t.assign_fn)&&e.apply(null,i),n._fulfill()}}(this)},t}(),findDeferral:function(){return null},trampoline:function(t){return t()}},window.__iced_k=window.__iced_k_noop=function(){},s="undefined"!=typeof exports&&null!==exports?exports:this,s.sortHelper=function(t,n){var i,e;return t.points===n.points?(i=t.text.replace(/[^a-z0-9]/gi,""),e=n.text.replace(/[^a-z0-9]/gi,""),i===e?0:i>e?1:-1):t.points>n.points?1:-1},$.isMobile=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)},$.randomInt=function(t){return Math.floor(Math.random()*t)},$.getParameterByName=function(t){var n,i,e;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i="[\\?&]"+t+"=([^&#]*)",n=new RegExp(i),e=n.exec(window.location.search),null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},Array.prototype.intersects=function(t){var n,i,e;for(i=0,e=this.length;e>i;i++)if(n=this[i],r.call(t,n)>=0)return!0;return!1},Array.prototype.removeItem=function(t){var n;return n=this.indexOf(t),-1!==n&&this.splice(n,1),this},i=24,a=function(t,n,i){return""+t+(n[i]!==t?" ("+n[i]+")":"")},s.SquadBuilder=function(){function n(t){this._makeRandomizerLoopFunc=l(this._makeRandomizerLoopFunc,this),this._randomizerLoopBody=l(this._randomizerLoopBody,this),this.releaseUnique=l(this.releaseUnique,this),this.claimUnique=l(this.claimUnique,this),this.onSquadNameChanged=l(this.onSquadNameChanged,this),this.onSquadDirtinessChanged=l(this.onSquadDirtinessChanged,this),this.onSquadLoadRequested=l(this.onSquadLoadRequested,this),this.onPointsUpdated=l(this.onPointsUpdated,this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Modification:[],Title:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:100},this.total_points=0,this.backend=null,this.current_squad={},this.language="English",this.setupUI(),this.setupEventHandlers(),this.resetCurrentSquad(),$.getParameterByName("f")===this.faction?this.loadFromSerialized($.getParameterByName("d")):this.addShip()}return n.prototype.resetCurrentSquad=function(){return this.current_squad={id:null,name:$.trim(this.squad_name_input.val())||"Unnamed Squadron",dirty:!1,additional_data:{points:this.total_points,description:"",cards:[]},faction:this.faction},this.total_points>0&&(this.current_squad.name="Unsaved Squadron",this.current_squad.dirty=!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},n.prototype.newSquadFromScratch=function(){return this.squad_name_input.val("New Squadron"),this.removeAllShips(),this.addShip(),this.resetCurrentSquad()},n.prototype.setupUI=function(){var t,n,i,e,a,o,r,l,d;for(n=100,i=2,t=1e3,this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="row-fluid">\n    <div class="span3 squad-name-container">\n        <div class="display-name">\n            <span class="squad-name"></span>\n            <i class="icon-pencil"></i>\n        </div>\n        <div class="input-append">\n            <input type="text" maxlength="64" placeholder="Name your squad..." />\n            <button class="btn save"><i class="icon-edit"></i></button>\n        </div>\n    </div>\n    <div class="span3 points-display-container">\n        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="100"> <span class="points-remaining-container">(<span class="points-remaining"></span> left)</span>\n    </div>\n    <div class="span6 pull-right button-container">\n        <div class="btn-group pull-right">\n\n            <button class="btn btn-primary view-as-text"><span class="hidden-phone">View as </span>Text</button>\n            <button class="btn btn-primary print-list hidden-phone hidden-tablet"><i class="icon-print"></i>&nbsp;Print</button>\n            <a class="btn btn-primary permalink"><i class="icon-link hidden-phone hidden-tablet"></i>&nbsp;Permalink</a>\n\n            <button class="btn btn-primary randomize" ><i class="icon-random hidden-phone hidden-tablet"></i>&nbsp;Random<span class="hidden-phone"> Squad!</span></button>\n            <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu">\n                <li><a class="randomize-options">Randomizer Options...</a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n\n<div class="row-fluid style="display: none;">\n    <div class="span12">\n        <button class="show-authenticated btn btn-primary save-list"><i class="icon-save"></i>&nbsp;Save</button>\n        <button class="show-authenticated btn btn-primary save-list-as"><i class="icon-copy"></i>&nbsp;Save As...</button>\n        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="icon-trash"></i>&nbsp;Delete</button>\n        <button class="show-authenticated btn btn-primary backend-list-my-squads show-authenticated">Load Squad</button>\n        <button class="btn btn-danger clear-squad">New Squad</button>\n        <span class="show-authenticated backend-status"></span>\n    </div>\n</div>')),this.container.append(this.status_container),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal hide fade text-list-modal"),this.container.append(this.list_modal),this.list_modal.append($.trim('<div class="modal-header">\n    <button type="button" class="close hidden-print" data-dismiss="modal" aria-hidden="true">&times;</button>\n\n    <div class="hidden-phone hidden-print">\n        <div class="fancy-header">\n            <div class="squad-name"></div>\n            <div class="mask">\n                <div class="outer-circle">\n                    <div class="inner-circle">\n                        <span class="total-points"></span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="fancy-under-header"></div>\n    </div>\n\n    <div class="visible-print">\n        <div class="fancy-header">\n            <div class="squad-name"></div>\n            <div class="mask">\n                <div class="outer-circle">\n                    <div class="inner-circle">\n                        <span class="total-points"></span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="fancy-under-header"></div>\n    </div>\n\n    <div class="visible-phone hidden-print">\n        <h4><span class="squad-name"></span> (<span class="total-points"></span>)<h4>\n    </div>\n\n</div>\n<div class="modal-body">\n    <div class="fancy-list hidden-phone"></div>\n    <div class="simple-list"></div>\n    <div class="bbcode-list">\n        Copy the BBCode below and paste it into your forum post.\n        <textarea></textarea>\n    </div>\n    <div class="xml-list">\n        something\n        <textarea></textarea>\n    </div>\n</div>\n<div class="modal-footer hidden-print">\n    <div class="btn-group list-display-mode">\n        <button class="btn select-simple-view">Simple</button>\n        <button class="btn select-fancy-view hidden-phone">Fancy</button>\n        <button class="btn select-bbcode-view">BBCode</button>\n        <button class="btn select-xml-view">XML</button>\n    </div>\n    <button class="btn print-list hidden-phone"><i class="icon-print"></i>&nbsp;Print</button>\n    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>\n</div>')),this.fancy_container=$(this.list_modal.find("div.modal-body .fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.bbcode_container=$(this.list_modal.find("div.modal-body .bbcode-list")),this.bbcode_textarea=$(this.bbcode_container.find("textarea")),this.bbcode_textarea.attr("readonly","readonly"),this.xml_container=$(this.list_modal.find("div.modal-body .xml-list")),this.xml_textarea=$(this.xml_container.find("textarea")),this.xml_textarea.attr("readonly","readonly"),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click(function(t){return function(){return t.select_simple_view_button.blur(),"simple"!==t.list_display_mode?(t.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),t.select_simple_view_button.addClass("btn-inverse"),t.list_display_mode="simple",t.simple_container.show(),t.fancy_container.hide(),t.bbcode_container.hide(),t.xml_container.hide()):void 0}}(this)),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click(function(t){return function(){return t.select_fancy_view_button.blur(),"fancy"!==t.list_display_mode?(t.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),t.select_fancy_view_button.addClass("btn-inverse"),t.list_display_mode="fancy",t.fancy_container.show(),t.simple_container.hide(),t.bbcode_container.hide(),t.xml_container.hide()):void 0}}(this)),this.select_bbcode_view_button=$(this.list_modal.find(".select-bbcode-view")),this.select_bbcode_view_button.click(function(t){return function(){return t.select_bbcode_view_button.blur(),"bbcode"!==t.list_display_mode?(t.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),t.select_bbcode_view_button.addClass("btn-inverse"),t.list_display_mode="bbcode",t.bbcode_container.show(),t.simple_container.hide(),t.fancy_container.hide(),t.xml_container.hide(),t.bbcode_textarea.select(),t.bbcode_textarea.focus()):void 0}}(this)),this.select_xml_view_button=$(this.list_modal.find(".select-xml-view")),this.select_xml_view_button.click(function(t){return function(){return t.select_xml_view_button.blur(),"xml"!==t.list_display_mode?(t.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),t.select_xml_view_button.addClass("btn-inverse"),t.list_display_mode="xml",t.xml_container.show(),t.simple_container.hide(),t.fancy_container.hide(),t.bbcode_container.hide(),t.xml_textarea.select(),t.xml_textarea.focus()):void 0}}(this)),$(window).width()>=768?(this.simple_container.hide(),this.select_fancy_view_button.click()):this.select_simple_view_button.click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click(function(t){return function(){return t.current_squad.dirty&&null!=t.backend?t.backend.warnUnsaved(t,function(){return t.newSquadFromScratch()}):t.newSquadFromScratch()}}(this)),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change(function(t){return function(){return t.onPointsUpdated($.noop)}}(this)),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.permalink=$(this.status_container.find("div.button-container a.permalink")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.squad_name_input.keypress(function(t){return function(n){return 13===n.which?(t.squad_name_save_button.click(),!1):void 0}}(this)),this.squad_name_input.change(function(t){return function(){return t.backend_status.fadeOut("slow")}}(this)),this.squad_name_input.blur(function(t){return function(){return t.squad_name_input.change(),t.squad_name_save_button.click()}}(this)),this.squad_name_display.click(function(t){return function(n){return n.preventDefault(),t.squad_name_display.hide(),t.squad_name_input.val($.trim(t.current_squad.name)),window.setTimeout(function(){return t.squad_name_input.focus(),t.squad_name_input.select()},100),t.squad_name_input.closest("div").show()}}(this)),this.squad_name_save_button.click(function(t){return function(n){var i;return n.preventDefault(),t.current_squad.dirty=!0,t.container.trigger("xwing-backend:squadDirtinessChanged"),i=t.current_squad.name=$.trim(t.squad_name_input.val()),i.length>0?(t.squad_name_display.show(),t.container.trigger("xwing-backend:squadNameChanged"),t.squad_name_input.closest("div").hide()):void 0}}(this)),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal hide fade"),$(document).append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim('<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>Random Squad Builder Options</h3>\n</div>\n<div class="modal-body">\n    <form>\n        <label>\n            Desired Points\n            <input type="number" class="randomizer-points" value="'+n+'" placeholder="'+n+'" />\n        </label>\n        <label>\n            Sets and Expansions (default all)\n            <select class="randomizer-sources" multiple="1" data-placeholder="Use all sets and expansions">\n            </select>\n        </label>\n        <label>\n            Maximum Seconds to Spend Randomizing\n            <input type="number" class="randomizer-timeout" value="'+i+'" placeholder="'+i+'" />\n        </label>\n        <label>\n            Maximum Randomization Iterations\n            <input type="number" class="randomizer-iterations" value="'+t+'" placeholder="'+t+'" />\n        </label>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary do-randomize" aria-hidden="true">Randomize!</button>\n    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>\n</div>')),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),d=s.expansions,r=0,l=d.length;l>r;r++)a=d[r],o=$(document.createElement("OPTION")),o.text(a),this.randomizer_source_selector.append(o);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomize_button.click(function(e){return function(s){var a,o,r;return s.preventDefault(),e.current_squad.dirty&&null!=e.backend?e.backend.warnUnsaved(e,function(){return e.randomize_button.click()}):(o=parseInt($(e.randomizer_options_modal.find(".randomizer-points")).val()),(isNaN(o)||0>=o)&&(o=n),r=parseInt($(e.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(r)||0>=r)&&(r=i),a=parseInt($(e.randomizer_options_modal.find(".randomizer-iterations")).val()),(isNaN(a)||0>=a)&&(a=t),e.randomSquad(o,e.randomizer_source_selector.val(),1e3*i,a))}}(this)),this.randomizer_options_modal.find("button.do-randomize").click(function(t){return function(n){return n.preventDefault(),t.randomizer_options_modal.modal("hide"),t.randomize_button.click()}}(this)),this.customize_randomizer.click(function(t){return function(n){return n.preventDefault(),t.randomizer_options_modal.modal()}}(this)),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click(function(t){return function(n){return n.preventDefault(),null!=t.backend?t.backend.list(t):void 0}}(this)),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click(function(t){return function(n){var i,e,s,a,o;return o=__iced_k_noop,s=iced.findDeferral(arguments),n.preventDefault(),null==t.backend||$(n.target).hasClass("disabled")?o():(i={points:t.total_points,description:t.describeSquad(),cards:t.listCards()},t.backend_status.html($.trim('<i class="icon-refresh icon-spin"></i>&nbsp;Saving squad...')),t.backend_status.show(),t.backend_save_list_button.addClass("disabled"),function(n){a=new iced.Deferrals(n,{parent:s,filename:"coffeescripts/xwing.coffee"}),t.backend.save(t.serialize(),t.current_squad.id,t.current_squad.name,t.faction,i,a.defer({assign_fn:function(){return function(){return e=arguments[0]}}(),lineno:450})),a._fulfill()}(function(){return o(e.success?(t.current_squad.dirty=!1,null!=t.current_squad.id?t.backend_status.html($.trim('<i class="icon-ok"></i>&nbsp;Squad updated successfully.')):(t.backend_status.html($.trim('<i class="icon-ok"></i>&nbsp;New squad saved successfully.')),t.current_squad.id=e.id),t.container.trigger("xwing-backend:squadDirtinessChanged")):(t.backend_status.html($.trim('<i class="icon-exclamation-sign"></i>&nbsp;'+e.error)),t.backend_save_list_button.removeClass("disabled")))}),void 0)}}(this)),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click(function(t){return function(n){return n.preventDefault(),null==t.backend||$(n.target).hasClass("disabled")?void 0:t.backend.showSaveAsModal(t)}}(this)),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click(function(t){return function(n){return n.preventDefault(),null==t.backend||$(n.target).hasClass("disabled")?void 0:t.backend.showDeleteModal(t)}}(this)),e=$(document.createElement("DIV")),e.addClass("container-fluid"),this.container.append(e),e.append($.trim('<div class="row-fluid">\n    <div class="span9 ship-container" />\n    <div class="span3 hidden-phone info-container" />\n</div>')),this.ship_container=$(e.find("div.ship-container")),this.info_container=$(e.find("div.info-container")),this.info_container.append($.trim('<div class="well well-small info-well">\n    <span class="info-name"></span>\n    <br />\n    <span class="info-sources"></span>\n    <table>\n        <tbody>\n            <tr class="info-ship">\n                <td>Ship</td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-skill">\n                <td>Skill</td>\n                <td class="info-data info-skill"></td>\n            </tr>\n            <tr class="info-energy">\n                <td><img class="icon-energy" src="images/transparent.png" alt="Energy" /></td>\n                <td class="info-data info-energy"></td>\n            </tr>\n            <tr class="info-attack">\n                <td><img class="icon-attack" src="images/transparent.png" alt="Attack" /></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-range">\n                <td>Range</td>\n                <td class="info-data info-range"></td>\n            </tr>\n            <tr class="info-agility">\n                <td><img class="icon-agility" src="images/transparent.png" alt="Agility" /></td>\n                <td class="info-data info-agility"></td>\n            </tr>\n            <tr class="info-hull">\n                <td><img class="icon-hull" src="images/transparent.png" alt="Hull" /></td>\n                <td class="info-data info-hull"></td>\n            </tr>\n            <tr class="info-shields">\n                <td><img class="icon-shields" src="images/transparent.png" alt="Shields" /></td>\n                <td class="info-data info-shields"></td>\n            </tr>\n            <tr class="info-actions">\n                <td>Actions</td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-upgrades">\n                <td>Upgrades</td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-text" />\n</div>')),this.info_container.hide(),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip()},n.prototype.setupEventHandlers=function(){return this.container.on("xwing:claimUnique",function(t){return function(n,i,e,s){return t.claimUnique(i,e,s)}}(this)).on("xwing:releaseUnique",function(t){return function(n,i,e,s){return t.releaseUnique(i,e,s)}}(this)).on("xwing:pointsUpdated",function(t){return function(n,i){return null==i&&(i=$.noop),t.onPointsUpdated(i)}}(this)).on("xwing-backend:squadLoadRequested",function(t){return function(n,i){return t.onSquadLoadRequested(i)}}(this)).on("xwing-backend:squadDirtinessChanged",function(t){return function(){return t.onSquadDirtinessChanged()}}(this)).on("xwing-backend:squadNameChanged",function(t){return function(){return t.onSquadNameChanged()}}(this)),$(window).on("xwing-backend:authenticationChanged",function(t){return function(){return t.resetCurrentSquad()}}(this)).on("xwing:beforeLanguageLoad",function(t){return function(n,i){return null==i&&(i=$.noop),t.pretranslation_serialized=t.serialize(),t.removeAllShips(),i()}}(this)).on("xwing:afterLanguageLoad",function(t){return function(n,i,e){var s,a,o,r;for(null==e&&(e=$.noop),t.language=i,t.loadFromSerialized(t.pretranslation_serialized),r=t.ships,a=0,o=r.length;o>a;a++)s=r[a],s.updateSelections();return t.pretranslation_serialized=void 0,e()}}(this)),this.view_list_button.click(function(t){return function(n){return n.preventDefault(),t.showTextListModal()}}(this)),this.print_list_button.click(function(t){return function(n){var i,e,s,a;for(n.preventDefault(),t.printable_container.find(".printable-header").html(t.list_modal.find(".modal-header").html()),t.printable_container.find(".printable-body").html(t.list_modal.find(".modal-body").html()),t.printable_container.find(".printable-body").text(""),a=t.ships,e=0,s=a.length;s>e;e++)i=a[e],null!=i.pilot&&t.printable_container.find(".printable-body").append(i.toHTML());return window.print()}}(this)),$(window).resize(function(t){return function(){return $(window).width()<768&&!t.simple_toggle_button.data("showingSimpleView")?t.simple_toggle_button.click():void 0}}(this))},n.prototype.onPointsUpdated=function(t){var n,i,e,s,a,o,r,l,d,u,c;for(this.total_points=0,u=this.ships,i=o=0,l=u.length;l>o;i=++o)s=u[i],s.validate(),this.total_points+=s.getPoints();for(this.total_points_span.text(this.total_points),e=parseInt(this.desired_points_input.val())-this.total_points,this.points_remaining_span.text(e),this.points_remaining_container.toggleClass("red",0>e),this.fancy_total_points_container.text(this.total_points),this.permalink.attr("href",""+window.location.href.split("?")[0]+"?f="+encodeURI(this.faction)+"&d="+encodeURI(this.serialize())),this.fancy_container.text(""),this.simple_container.html("<table></table>"),n=[],a=[],c=this.ships,r=0,d=c.length;d>r;r++)s=c[r],null!=s.pilot&&(this.fancy_container.append(s.toHTML()),this.simple_container.find("table").append(s.toTableRow()),n.push(s.toBBCode()),a.push(s.toXML()));return this.bbcode_container.find("textarea").val($.trim(""+n.join("\n\n")+"[b][i]Total: "+this.total_points+"[/i][/b][url="+this.permalink.attr("href")+"]View in Yet Another Squad Builder[/url]")),this.xml_container.find("textarea").val($.trim("<XML>\n"+a.join("\n")+"\n</XML>")),t(this.total_points)},n.prototype.onSquadLoadRequested=function(t){return this.current_squad=t,this.backend_delete_list_button.removeClass("disabled"),this.squad_name_input.val(this.current_squad.name),this.squad_name_placeholder.text(this.current_squad.name),this.loadFromSerialized(t.serialized),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadDirtinessChanged")},n.prototype.onSquadDirtinessChanged=function(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&this.total_points>0)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id)},n.prototype.onSquadNameChanged=function(){var t;return t=this.current_squad.name.length>i?""+this.current_squad.name.substr(0,i)+"&hellip;":this.current_squad.name,this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(t),this.squad_name_input.val(this.current_squad.name)},n.prototype.removeAllShips=function(){for(;this.ships.length>0;)this.removeShip(this.ships[0]);if(this.ships.length>0)throw"Ships not emptied"},n.prototype.showTextListModal=function(){return this.list_modal.modal("show")},n.prototype.serialize=function(){var t,n;return t=2,"v"+t+"!"+function(){var t,i,e,s;for(e=this.ships,s=[],t=0,i=e.length;i>t;t++)n=e[t],null!=n.pilot&&s.push(n.toSerialized());return s}.call(this).join(";")},n.prototype.loadFromSerialized=function(t){var n,i,e,s,a,o,r,l,d,u;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),e=/^v(\d+)!(.*)/,n=e.exec(t),null!=n)for(d=n[2].split(";"),a=0,r=d.length;r>a;a++)s=d[a],""!==s&&(i=this.addShip(),i.fromSerialized(parseInt(n[1]),s));else for(u=t.split(";"),o=0,l=u.length;l>o;o++)s=u[o],""!==t&&(i=this.addShip(),i.fromSerialized(1,s));return this.suppress_automatic_new_ship=!1,this.addShip()},n.prototype.uniqueIndex=function(t,n){if(!(n in this.uniques_in_use))throw"Invalid unique type '"+n+"'";return this.uniques_in_use[n].indexOf(t)},n.prototype.claimUnique=function(t,n,i){var e,a;if(!(this.uniqueIndex(t,n)<0))throw"Unique "+n+" '"+t.name+"' already claimed";if("Pilot"===n){if(e=s.upgrades[t.name],null!=e&&null!=(null!=e?e.unique:void 0)){if(!(this.uniqueIndex(e,"Upgrade")<0))throw"Unique "+n+" '"+t.name+"' already claimed as crew";this.uniques_in_use.Upgrade.push(e)}}else if("Upgrade"===n&&"Crew"===t.slot&&(a=s.pilots[t.name],null!=a&&null!=(null!=a?a.unique:void 0))){if(!(this.uniqueIndex(a,"Pilot")<0))throw"Unique "+n+" '"+t.name+"' already claimed as pilot";this.uniques_in_use.Pilot.push(a)}return this.uniques_in_use[n].push(t),i()},n.prototype.releaseUnique=function(t,n,i){var e,a,o;if(a=this.uniqueIndex(t,n),!(a>=0))throw"Unique "+n+" '"+t.name+"' not in use";if(this.uniques_in_use[n].splice(a,1),"Pilot"===n){if(e=s.upgrades[t.name],null!=e&&null!=(null!=e?e.unique:void 0)){if(a=this.uniqueIndex(e,"Upgrade"),0>a)throw"Unique crew accompanying "+t.name+" was not also claimed!";this.uniques_in_use.Upgrade.splice(a,1)}}else if("Upgrade"===n&&"Crew"===t.slot&&(o=s.pilots[t.name],null!=o&&null!=(null!=o?o.unique:void 0))){if(a=this.uniqueIndex(o,"Pilot"),0>a)throw"Unique pilot accompanying "+t.name+" was not also claimed!";this.uniques_in_use.Pilot.splice(a,1)}return i()},n.prototype.addShip=function(){var t;return t=new e({builder:this,container:this.ship_container}),this.ships.push(t),t},n.prototype.removeShip=function(t){var n,i,e;e=__iced_k_noop,n=iced.findDeferral(arguments),function(){return function(e){i=new iced.Deferrals(e,{parent:n,filename:"coffeescripts/xwing.coffee",funcname:"SquadBuilder.removeShip"}),t.destroy(i.defer({lineno:755})),i._fulfill()}}(this)(function(t){return function(){!function(e){i=new iced.Deferrals(e,{parent:n,filename:"coffeescripts/xwing.coffee",funcname:"SquadBuilder.removeShip"}),t.container.trigger("xwing:pointsUpdated",i.defer({lineno:756})),i._fulfill()}(function(){return t.current_squad.dirty=!0,t.container.trigger("xwing-backend:squadDirtinessChanged")})}}(this))},n.prototype.matcher=function(t,n){return t.toUpperCase().indexOf(n.toUpperCase())>=0},n.prototype.getAvailablePilotsIncluding=function(t,n){var i,e,a,o,l,d,u,c,h,p,f,_,m;for(null==n&&(n=""),u=function(){var t,a;t=s.pilots,a=[];for(e in t)i=t[e],s.ships[i.ship].faction===this.faction&&this.matcher(e,n)&&(null==i.unique||r.call(this.uniques_in_use.Pilot,i)<0)&&a.push(i);return a}.call(this),null!=t&&null!=t.unique&&this.matcher(t.name,n)&&u.push(t),o={},_=function(){var t,n,e;for(e=[],t=0,n=u.length;n>t;t++)i=u[t],e.push({id:i.id,text:""+i.name+" ("+i.points+")",points:i.points,ship:i.ship});return e}(),c=0,p=_.length;p>c;c++)a=_[c],a.ship in o||(o[a.ship]=[]),o[a.ship].push(a);for(l=[],m=Object.keys(o).sort(),h=0,f=m.length;f>h;h++)d=m[h],l.push({text:d,children:o[d].sort(s.sortHelper)});return l},n.prototype.getAvailableUpgradesIncluding=function(t,n,i){var e,a,o;return null==i&&(i=""),e=function(){var n,e;n=s.upgrades,e=[];for(o in n)a=n[o],a.slot===t&&this.matcher(o,i)&&(null==a.unique||r.call(this.uniques_in_use.Upgrade,a)<0)&&(null==a.faction||a.faction===this.faction)&&e.push(a);return e}.call(this),null!=n&&null!=n.unique&&this.matcher(n.name,i)&&e.push(n),function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)a=e[t],i.push({id:a.id,text:""+a.name+" ("+a.points+")",points:a.points});return i}().sort(s.sortHelper)},n.prototype.getAvailableModificationsIncluding=function(t,n,i){var e,a,o,l,d,u,c,h,p,f;if(null==i&&(i=""),d=function(){var t,e;t=s.modifications,e=[];for(l in t)o=t[l],!this.matcher(l,i)||!(null==o.unique||r.call(this.uniques_in_use.Modification,o)<0)||null!=o.faction&&o.faction!==this.faction||null!=n&&null!=o.restriction_func&&!o.restriction_func(n)||e.push(o);return e}.call(this),e=!1,"Royal Guard TIE"===(null!=n?null!=(h=n.title)?null!=(p=h.data)?p.name:void 0:void 0:void 0))for(f=function(){var t,i,e,s;for(e=n.modifications,s=[],t=0,i=e.length;i>t;t++)o=e[t],null!=(null!=o?o.data:void 0)&&s.push(o.data);return s}(),u=0,c=f.length;c>u;u++)a=f[u],d.removeItem(a),a===t&&(e=!0);return null!=t&&(null!=t.unique&&this.matcher(t.name,i)||e)&&d.push(t),function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)o=d[t],i.push({id:o.id,text:""+o.name+" ("+o.points+")",points:o.points});return i}().sort(s.sortHelper)},n.prototype.getAvailableTitlesIncluding=function(t,n,i){var e,a,o;return null==i&&(i=""),o=function(){var n,o;n=s.titles,o=[];for(a in n)e=n[a],e.ship!==t.data.name||!this.matcher(a,i)||!(null==e.unique||r.call(this.uniques_in_use.Title,e)<0)||null!=e.faction&&e.faction!==this.faction||null!=t&&null!=e.restriction_func&&!e.restriction_func(t)||o.push(e);return o}.call(this),null!=n&&null!=n.unique&&this.matcher(n.name,i)&&o.push(n),function(){var t,n,i;for(i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push({id:e.id,text:""+e.name+" ("+e.points+")",points:e.points});return i}().sort(s.sortHelper)},n.prototype.showTooltip=function(t,n){var i,e,o,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k,q,x,S,I,B,C,z,A,U,P,T,D,L,R,M,N;if(n!==this.tooltip_currently_displaying){switch(t){case"Ship":this.info_container.find(".info-sources").text(function(){var t,i,e,a;for(e=n.pilot.sources,a=[],t=0,i=e.length;i>t;t++)c=e[t],a.push(s.translate(this.language,"sources",c));return a}.call(this).sort().join(", ")),o=n.effectiveStats(),l=$.grep(o.actions,function(t){return r.call(n.data.actions,t)<0}),this.info_container.find(".info-name").html(""+(n.pilot.unique?"&middot;&nbsp;":"")+n.pilot.name),this.info_container.find("p.info-text").html(null!=(h=n.pilot.text)?h:""),this.info_container.find("tr.info-ship td.info-data").text(n.pilot.ship),this.info_container.find("tr.info-ship").show(),this.info_container.find("tr.info-skill td.info-data").text(a(n.pilot.skill,o,"skill")),this.info_container.find("tr.info-skill").show(),this.info_container.find("tr.info-attack td.info-data").text(a(null!=(p=null!=(x=n.pilot.ship_override)?x.attack:void 0)?p:n.data.attack,o,"attack")),this.info_container.find("tr.info-attack").toggle(null!=(null!=(P=n.pilot.ship_override)?P.attack:void 0)||null!=n.data.attack),this.info_container.find("tr.info-energy td.info-data").text(a(null!=(T=null!=(D=n.pilot.ship_override)?D.energy:void 0)?T:n.data.energy,o,"energy")),this.info_container.find("tr.info-energy").toggle(null!=(null!=(L=n.pilot.ship_override)?L.energy:void 0)||null!=n.data.energy),this.info_container.find("tr.info-range").hide(),this.info_container.find("tr.info-agility td.info-data").text(a(null!=(R=null!=(M=n.pilot.ship_override)?M.agility:void 0)?R:n.data.agility,o,"agility")),this.info_container.find("tr.info-agility").show(),this.info_container.find("tr.info-hull td.info-data").text(a(null!=(N=null!=(f=n.pilot.ship_override)?f.hull:void 0)?N:n.data.hull,o,"hull")),this.info_container.find("tr.info-hull").show(),this.info_container.find("tr.info-shields td.info-data").text(a(null!=(_=null!=(m=n.pilot.ship_override)?m.shields:void 0)?_:n.data.shields,o,"shields")),this.info_container.find("tr.info-shields").show(),this.info_container.find("tr.info-actions td.info-data").html(function(){var t,a,o,r;
for(o=n.data.actions.concat(function(){var t,n,i;for(i=[],t=0,n=l.length;n>t;t++)e=l[t],i.push("<strong>"+s.translate(this.language,"action",e)+"</strong>");return i}.call(this)),r=[],t=0,a=o.length;a>t;t++)i=o[t],r.push(s.translate(this.language,"action",i));return r}.call(this).join(", ")),this.info_container.find("tr.info-actions").show(),this.info_container.find("tr.info-upgrades").show(),this.info_container.find("tr.info-upgrades td.info-data").text(function(){var t,i,e,a;for(e=n.pilot.slots,a=[],t=0,i=e.length;i>t;t++)u=e[t],a.push(s.translate(this.language,"slot",u));return a}.call(this).join(", ")||"None");break;case"Pilot":this.info_container.find(".info-sources").text(function(){var t,i,e,a;for(e=n.sources,a=[],t=0,i=e.length;i>t;t++)c=e[t],a.push(s.translate(this.language,"sources",c));return a}.call(this).sort().join(", ")),this.info_container.find(".info-name").html(""+(n.unique?"&middot;&nbsp;":"")+n.name),this.info_container.find("p.info-text").html(null!=(g=n.text)?g:""),d=s.ships[n.ship],this.info_container.find("tr.info-ship td.info-data").text(n.ship),this.info_container.find("tr.info-ship").show(),this.info_container.find("tr.info-skill td.info-data").text(n.skill),this.info_container.find("tr.info-skill").show(),this.info_container.find("tr.info-attack td.info-data").text(null!=(v=null!=(b=n.ship_override)?b.attack:void 0)?v:d.attack),this.info_container.find("tr.info-attack").toggle(null!=(null!=(y=n.ship_override)?y.attack:void 0)||null!=d.attack),this.info_container.find("tr.info-energy td.info-data").text(null!=(w=null!=(k=n.ship_override)?k.energy:void 0)?w:d.energy),this.info_container.find("tr.info-energy").toggle(null!=(null!=(q=n.ship_override)?q.energy:void 0)||null!=d.energy),this.info_container.find("tr.info-range").hide(),this.info_container.find("tr.info-agility td.info-data").text(null!=(S=null!=(I=n.ship_override)?I.agility:void 0)?S:d.agility),this.info_container.find("tr.info-agility").show(),this.info_container.find("tr.info-hull td.info-data").text(null!=(B=null!=(C=n.ship_override)?C.hull:void 0)?B:d.hull),this.info_container.find("tr.info-hull").show(),this.info_container.find("tr.info-shields td.info-data").text(null!=(z=null!=(A=n.ship_override)?A.shields:void 0)?z:d.shields),this.info_container.find("tr.info-shields").show(),this.info_container.find("tr.info-actions td.info-data").text(function(){var t,i,a,o;for(a=s.ships[n.ship].actions,o=[],t=0,i=a.length;i>t;t++)e=a[t],o.push(s.translate(this.language,"action",e));return o}.call(this).join(", ")),this.info_container.find("tr.info-actions").show(),this.info_container.find("tr.info-upgrades").show(),this.info_container.find("tr.info-upgrades td.info-data").text(function(){var t,i,e,a;for(e=n.slots,a=[],t=0,i=e.length;i>t;t++)u=e[t],a.push(s.translate(this.language,"slot",u));return a}.call(this).join(", ")||"None");break;case"Addon":this.info_container.find(".info-sources").text(function(){var t,i,e,a;for(e=n.sources,a=[],t=0,i=e.length;i>t;t++)c=e[t],a.push(s.translate(this.language,"sources",c));return a}.call(this).sort().join(", ")),this.info_container.find(".info-name").html(""+(n.unique?"&middot;&nbsp;":"")+n.name),this.info_container.find("p.info-text").html(null!=(U=n.text)?U:""),this.info_container.find("tr.info-ship").hide(),this.info_container.find("tr.info-skill").hide(),null!=n.energy?(this.info_container.find("tr.info-energy td.info-data").text(n.energy),this.info_container.find("tr.info-energy").show()):this.info_container.find("tr.info-energy").hide(),null!=n.attack?(this.info_container.find("tr.info-attack td.info-data").text(n.attack),this.info_container.find("tr.info-attack").show()):this.info_container.find("tr.info-attack").hide(),null!=n.range?(this.info_container.find("tr.info-range td.info-data").text(n.range),this.info_container.find("tr.info-range").show()):this.info_container.find("tr.info-range").hide(),this.info_container.find("tr.info-agility").hide(),this.info_container.find("tr.info-hull").hide(),this.info_container.find("tr.info-shields").hide(),this.info_container.find("tr.info-actions").hide(),this.info_container.find("tr.info-upgrades").hide()}return this.info_container.show(),this.tooltip_currently_displaying=n}},n.prototype._randomizerLoopBody=function(n){var i,a,o,r,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k,q,x,S,I,B,C,z,A,U,P,T,D,L,R,M,N,W;if(n.keep_running&&n.iterations<n.max_iterations){if(n.iterations++,this.total_points===n.max_points)n.keep_running=!1;else if(this.total_points<n.max_points){for(v=[],P=this.ships,y=0,x=P.length;x>y;y++){for(f=P[y],T=f.upgrades,w=0,S=T.length;S>w;w++)b=T[w],null==b.data&&v.push(b);for(null!=f.title&&null==f.title.data&&v.push(f.title),D=f.modifications,k=0,I=D.length;I>k;k++)u=D[k],null==u.data&&v.push(u)}if(d=$.randomInt(1+v.length),0===d)o=this.getAvailablePilotsIncluding(),_=o[$.randomInt(o.length)],h=_.children[$.randomInt(_.children.length)],s.pilotsById[h.id].sources.intersects(n.allowed_sources)&&(c=this.addShip(),c.setPilotById(h.id));else switch(i=v[d-1],i.type){case"Upgrade":l=function(){var t,e,a,o;for(a=this.getAvailableUpgradesIncluding(i.slot),o=[],t=0,e=a.length;e>t;t++)b=a[t],s.upgradesById[b.id].sources.intersects(n.allowed_sources)&&o.push(b);return o}.call(this),l.length>0&&i.setById(l[$.randomInt(l.length)].id);break;case"Title":r=function(){var t,e,a,o;for(a=this.getAvailableTitlesIncluding(i.ship),o=[],t=0,e=a.length;e>t;t++)g=a[t],s.titlesById[g.id].sources.intersects(n.allowed_sources)&&o.push(g);return o}.call(this),r.length>0&&i.setById(r[$.randomInt(r.length)].id);break;case"Modification":a=function(){var t,e,a,o;for(a=this.getAvailableModificationsIncluding(null,i.ship),o=[],t=0,e=a.length;e>t;t++)u=a[t],s.modificationsById[u.id].sources.intersects(n.allowed_sources)&&o.push(u);return o}.call(this),a.length>0&&i.setById(a[$.randomInt(a.length)].id);break;default:throw"Invalid addon type "+i.type}}else{for(p=[],L=this.ships,q=0,B=L.length;B>q;q++){for(f=L[q],p.push(f),R=f.upgrades,A=0,C=R.length;C>A;A++)b=R[A],null!=b.data&&p.push(b);null!=(null!=(M=f.title)?M.data:void 0)&&p.push(f.title),null!=(null!=(N=f.modification)?N.data:void 0)&&p.push(f.modification)}if(p.length>0)if(m=p[$.randomInt(p.length)],m instanceof e)this.removeShip(m);else{if(!(m instanceof t))throw"Unknown thing to remove "+m;m.setData(null)}}return window.setTimeout(this._makeRandomizerLoopFunc(n),0)}for(window.clearTimeout(n.timer),W=this.ships,U=0,z=W.length;z>U;U++)f=W[U],f.updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()},n.prototype._makeRandomizerLoopFunc=function(t){return function(n){return function(){return n._randomizerLoopBody(t)}}(this)},n.prototype.randomSquad=function(t,n,i,e){var a,o;for(null==t&&(t=100),null==n&&(n=null),null==i&&(i=1e3),null==e&&(e=1e3),this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0;this.ships.length>0;)this.removeShip(this.ships[0]);if(this.ships.length>0)throw"Ships not emptied";return a={iterations:0,max_points:t,allowed_sources:n,max_iterations:e,keep_running:!0,allowed_sources:null!=n?n:s.expansions},o=function(){return function(){return a.keep_running=!1}}(this),a.timer=window.setTimeout(o,i),window.setTimeout(this._makeRandomizerLoopFunc(a),0),this.resetCurrentSquad(),this.current_squad.name="Random Squad",this.container.trigger("xwing-backend:squadNameChanged")},n.prototype.setBackend=function(t){return this.backend=t},n.prototype.describeSquad=function(){var t;return function(){var n,i,e,s;for(e=this.ships,s=[],n=0,i=e.length;i>n;n++)t=e[n],null!=t.pilot&&s.push(t.pilot.name);return s}.call(this).join(", ")},n.prototype.listCards=function(){var t,n,i,e,s,a,o,r,l,d,u;for(t={},r=this.ships,e=0,a=r.length;a>e;e++)if(n=r[e],null!=n.pilot){for(t[n.pilot.name]=null,l=n.upgrades,s=0,o=l.length;o>s;s++)i=l[s],null!=i.data&&(t[i.data.name]=null);null!=(null!=(d=n.title)?d.data:void 0)&&(t[n.title.data.name]=null),null!=(null!=(u=n.modification)?u.data:void 0)&&(t[n.modification.data.name]=null)}return Object.keys(t).sort()},n}(),e=function(){function t(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.upgrades=[],this.modifications=[],this.title=null,this.setupUI()}return t.prototype.destroy=function(t){var n;if(this.resetPilot(),this.resetAddons(),this.teardownUI(),n=this.builder.ships.indexOf(this),0>n)throw"Ship not registered with builder";return this.builder.ships.splice(n,1),t()},t.prototype.copyFrom=function(t){var n,i,e,s,a,o,l,d,u,c,h,p,f,_,m,g;if(t===this)throw"Cannot copy from self";if(null!=t.pilot&&null!=t.data&&!t.pilot.unique){for(this.setPilotById(t.pilot.id),e=[],null!=t.title&&t.title.conferredAddons.length>0&&e.concat(t.title.conferred_addons),null!=(null!=(h=t.modifications[0])?h.data:void 0)&&e.concat(t.modifications[0].conferred_addons),p=t.upgrades,n=a=0,d=p.length;d>a;n=++a)s=p[n],null!=s.data&&r.call(e,s)<0&&!s.data.unique&&this.upgrades[n].setById(s.data.id);if(null==(null!=(f=t.title)?f.data:void 0)||t.title.data.unique||this.title.setById(t.title.data.id),(null!=(_=t.modifications[0])?_.data:void 0)&&!t.modifications[0].data.unique&&this.modifications[0].setById(t.modifications[0].data.id),null!=t.title&&t.title.conferredAddons.length>0)for(m=t.title.conferredAddons,n=o=0,u=m.length;u>o;n=++o)i=m[n],i.data.unique||this.title.conferredAddons[n].setById(i.data.id);if(null!=t.modifications[0]&&t.modifications[0].conferredAddons.length>0)for(g=t.modifications[0].conferredAddons,n=l=0,c=g.length;c>l;n=++l)i=g[n],i.data.unique||this.modifications[0].conferredAddons[n].setById(i.data.id);return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}},t.prototype.setPilotById=function(t){return this.setPilot(s.pilotsById[parseInt(t)])},t.prototype.setPilotByName=function(t){return this.setPilot(s.pilots[$.trim(t)])},t.prototype.setPilot=function(t){var n,i,e,a;return a=__iced_k_noop,i=iced.findDeferral(arguments),t===this.pilot?a():(null==this.pilot&&(this.builder.suppress_automatic_new_ship||this.builder.addShip(),this.remove_button.fadeIn("fast")),this.resetPilot(),this.resetAddons(),this.data=s.ships[null!=t?t.ship:void 0],function(n){return function(s){return null==(null!=t?t.unique:void 0)?s():(!function(s){e=new iced.Deferrals(s,{parent:i,filename:"coffeescripts/xwing.coffee",funcname:"Ship.setPilot"}),n.builder.container.trigger("xwing:claimUnique",[t,"Pilot",e.defer({lineno:1097})]),e._fulfill()}(s),void 0)}}(this)(function(i){return function(){var e,s,o,r;for(i.pilot=t,null!=i.pilot&&i.setupAddons(),i.builder.container.trigger("xwing:pointsUpdated"),o=i.row.attr("class").split(" "),e=0,s=o.length;s>e;e++)n=o[e],0===n.indexOf("ship-")&&i.row.removeClass(n);return i.row.addClass("ship-"+i.data.name.toLowerCase().replace(/[^a-z0-9]/gi,"")+"0"),a(i.copy_button.toggle(!(null!=(r=i.pilot)?r.unique:void 0)))}}(this)),void 0)},t.prototype.resetPilot=function(){var t,n,i;i=__iced_k_noop,t=iced.findDeferral(arguments),function(i){return function(e){var s;return null==(null!=(s=i.pilot)?s.unique:void 0)?e():(!function(e){n=new iced.Deferrals(e,{parent:t,filename:"coffeescripts/xwing.coffee",funcname:"Ship.resetPilot"}),i.builder.container.trigger("xwing:releaseUnique",[i.pilot,"Pilot",n.defer({lineno:1110})]),n._fulfill()}(e),void 0)}}(this)(function(t){return function(){return t.pilot=null}}(this))},t.prototype.setupAddons=function(){var t,n,i,e,a;for(a=null!=(e=this.pilot.slots)?e:[],n=0,i=a.length;i>n;n++)t=a[n],this.upgrades.push(new s.Upgrade({ship:this,container:this.addon_container,slot:t}));return this.pilot.ship in s.titlesByShip&&(this.title=new s.Title({ship:this,container:this.addon_container})),this.modifications.push(new s.Modification({ship:this,container:this.addon_container}))},t.prototype.resetAddons=function(){var t,n,i,e,s;s=__iced_k_noop,i=iced.findDeferral(arguments),function(s){return function(a){var o,r,l,d,u,c;for(e=new iced.Deferrals(a,{parent:i,filename:"coffeescripts/xwing.coffee",funcname:"Ship.resetAddons"}),null!=s.title&&s.title.destroy(e.defer({lineno:1132})),u=s.upgrades,o=0,l=u.length;l>o;o++)n=u[o],n.destroy(e.defer({lineno:1134}));for(c=s.modifications,r=0,d=c.length;d>r;r++)t=c[r],null!=t&&t.destroy(e.defer({lineno:1136}));e._fulfill()}}(this)(function(t){return function(){return t.upgrades=[],t.modifications=[],t.title=null}}(this))},t.prototype.getPoints=function(){var t,n,i,e,s,a,o,r,l,d,u,c,h,p;for(n=(null!=(r=null!=(l=this.pilot)?l.points:void 0)?r:0)+(null!=(d=null!=(u=this.title)?u.getPoints():void 0)?d:0),c=this.upgrades,e=0,a=c.length;a>e;e++)i=c[e],n+=i.getPoints();for(h=this.modifications,s=0,o=h.length;o>s;s++)t=h[s],n+=null!=(p=null!=t?t.getPoints():void 0)?p:0;return this.points_container.text(n),null!=this.pilot&&this.points_container.show(),n},t.prototype.updateSelections=function(){var t,n,i,e,s,a,o,r,l;if(null!=this.pilot){for(this.pilot_selector.select2("data",{id:this.pilot.id,text:""+this.pilot.name+" ("+this.pilot.points+")"}),o=this.upgrades,i=0,s=o.length;s>i;i++)n=o[i],n.updateSelection();for(null!=this.title&&this.title.updateSelection(),r=this.modifications,l=[],e=0,a=r.length;a>e;e++)t=r[e],null!=t?l.push(t.updateSelection()):l.push(void 0);return l}return this.pilot_selector.select2("data",null)},t.prototype.setupUI=function(){return this.row=$(document.createElement("DIV")),this.row.addClass("row-fluid ship"),this.container.append(this.row),this.row.append($.trim('<div class="span3 pilot-selector-container">\n    <input type="hidden" />\n</div>\n<div class="span1 points-display-container">\n    <span></span>\n</div>\n<div class="span6 addon-container" />\n<div class="span2 button-container">\n    <button class="btn btn-danger remove-pilot"><span class="visible-desktop visible-tablet hidden-phone" data-toggle="tooltip" title="Remove Pilot"><i class="icon-remove"></i></span><span class="hidden-desktop hidden-tablet visible-phone">Remove Pilot</span></button>\n    <button class="btn copy-pilot"><span class="visible-desktop visible-tablet hidden-phone" data-toggle="tooltip" title="Clone Pilot"><i class="icon-copy"></i></span><span class="hidden-desktop hidden-tablet visible-phone">Clone Pilot</span></button>\n</div>')),this.row.find(".button-container span").tooltip(),this.pilot_selector=$(this.row.find("div.pilot-selector-container input[type=hidden]")),this.pilot_selector.select2({width:"100%",placeholder:s.translate(this.builder.language,"ui","pilotSelectorPlaceholder"),query:function(t){return function(n){return n.callback({more:!1,results:t.builder.getAvailablePilotsIncluding(t.pilot,n.term)})}}(this),minimumResultsForSearch:$.isMobile()?-1:0}),this.pilot_selector.on("change",function(t){return function(){return t.setPilotById(t.pilot_selector.select2("val")),t.builder.current_squad.dirty=!0,t.builder.container.trigger("xwing-backend:squadDirtinessChanged"),t.builder.backend_status.fadeOut("slow")}}(this)),this.pilot_selector.data("select2").results.on("mousemove-filtered",function(t){return function(n){var i;return i=$(n.target).closest(".select2-result-selectable").data("select2-data"),null!=(null!=i?i.id:void 0)?t.builder.showTooltip("Pilot",s.pilotsById[i.id]):void 0}}(this)),this.pilot_selector.data("select2").container.on("mouseover",function(t){return function(){return null!=t.data?t.builder.showTooltip("Ship",t):void 0}}(this)),this.points_container=$(this.row.find(".points-display-container span")),this.points_container.hide(),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click(function(t){return function(n){return n.preventDefault(),t.row.slideUp("fast",function(){var n;return t.builder.removeShip(t),null!=(n=t.backend_status)?n.fadeOut("slow"):void 0})}}(this)),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click(function(t){return function(){var n;return n=t.builder.ships[t.builder.ships.length-1],n.copyFrom(t)}}(this)),this.copy_button.hide()},t.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},t.prototype.toString=function(){return null!=this.pilot?"Pilot "+this.pilot.name+" flying "+this.data.name:"Ship without pilot"},t.prototype.toHTML=function(){var t,n,i,e,s,o,r,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k,q,x,S,I,B;for(e=this.effectiveStats(),n="",f=e.actions,u=0,h=f.length;h>u;u++)t=f[u],n+=function(){switch(t){case"Focus":return'<img class="icon-focus" src="images/transparent.png" />';case"Evade":return'<img class="icon-evade" src="images/transparent.png" />';case"Barrel Roll":return'<img class="icon-barrel-roll" src="images/transparent.png" />';case"Target Lock":return'<img class="icon-target-lock" src="images/transparent.png" />';case"Boost":return'<img class="icon-boost" src="images/transparent.png" />';case"Coordinate":return'<img class="icon-coordinate" src="images/transparent.png" />';case"Jam":return'<img class="icon-jam" src="images/transparent.png" />';case"Recover":return'<img class="icon-recover" src="images/transparent.png" />';case"Reinforce":return'<img class="icon-reinforce" src="images/transparent.png" />';case"Cloak":return'<img class="icon-cloak" src="images/transparent.png" />';default:return"<span>&nbsp;"+t+"<span>"}}();if(i=null!=(null!=(_=this.pilot.ship_override)?_.attack:void 0)||null!=this.data.attack?$.trim('<img class="icon-attack" src="images/transparent.png" />\n<span class="info-data info-attack">'+a(null!=(y=null!=(w=this.pilot.ship_override)?w.attack:void 0)?y:this.data.attack,e,"attack")+"</span>"):"",s=null!=(null!=(k=this.pilot.ship_override)?k.energy:void 0)||null!=this.data.energy?$.trim('<img class="icon-energy" src="images/transparent.png" />\n<span class="info-data info-energy">'+a(null!=(q=null!=(x=this.pilot.ship_override)?x.energy:void 0)?q:this.data.energy,e,"energy")+"</span>"):"",o=$.trim('<div class="fancy-pilot-header">\n    <div class="pilot-header-text">'+this.pilot.name+" / "+this.data.name+'</div>\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle pilot-points">'+this.pilot.points+'</div>\n        </div>\n    </div>\n</div>\n<div class="fancy-pilot-stats">\n    <div class="pilot-stats-content">\n        <span class="info-data info-skill">PS '+a(this.pilot.skill,e,"skill")+"</span>\n        "+i+"\n        "+s+'\n        <img class="icon-agility" src="images/transparent.png" />\n        <span class="info-data info-agility">'+a(null!=(S=null!=(I=this.pilot.ship_override)?I.agility:void 0)?S:this.data.agility,e,"agility")+'</span>\n        <img class="icon-hull" src="images/transparent.png" />\n        <span class="info-data info-hull">'+a(null!=(B=null!=(m=this.pilot.ship_override)?m.hull:void 0)?B:this.data.hull,e,"hull")+'</span>\n        <img class="icon-shields" src="images/transparent.png" />\n        <span class="info-data info-shields">'+a(null!=(g=null!=(v=this.pilot.ship_override)?v.shields:void 0)?g:this.data.shields,e,"shields")+"</span>\n        &nbsp;\n        "+n+"\n    </div>\n</div>"),this.pilot.text&&(o+=$.trim('<div class="fancy-pilot-text">'+this.pilot.text+"</div>")),l=function(){var t,n,i,e;for(i=this.upgrades,e=[],t=0,n=i.length;n>t;t++)d=i[t],null!=d.data&&e.push(d);return e}.call(this).concat(function(){var t,n,i,e;for(i=this.modifications,e=[],t=0,n=i.length;n>t;t++)r=i[t],null!=r.data&&e.push(r);return e}.call(this)),null!=(null!=(b=this.title)?b.data:void 0)&&l.push(this.title),l.length>0){for(o+=$.trim('<div class="fancy-upgrade-container">'),c=0,p=l.length;p>c;c++)d=l[c],o+=d.toHTML();o+=$.trim("</div>")}return'<div class="fancy-ship">'+o+"</div>"},t.prototype.toTableRow=function(){var t,n,i,e,s,a,o;if(i=$.trim('<tr class="simple-pilot">\n    <td class="name">'+this.pilot.name+" &mdash; "+this.data.name+'</td>\n    <td class="points">'+this.pilot.points+"</td>\n</tr>"),n=function(){var t,n,i,s;for(i=this.upgrades,s=[],t=0,n=i.length;n>t;t++)e=i[t],null!=e.data&&s.push(e);return s}.call(this).concat(function(){var n,i,e,s;for(e=this.modifications,s=[],n=0,i=e.length;i>n;n++)t=e[n],null!=t.data&&s.push(t);return s}.call(this)),null!=(null!=(o=this.title)?o.data:void 0)&&n.push(this.title),n.length>0)for(s=0,a=n.length;a>s;s++)e=n[s],i+=e.toTableRow();return i+="<tr><td>&nbsp;</td><td></td></tr>"},t.prototype.toBBCode=function(){var t,n,i,e,s,a,o,r,l;if(t="[b]"+this.pilot.name+" ("+this.pilot.points+")[/b]",e=function(){var t,n,i,e;for(i=this.upgrades,e=[],t=0,n=i.length;n>t;t++)s=i[t],null!=s.data&&e.push(s);return e}.call(this).concat(function(){var t,n,e,s;for(e=this.modifications,s=[],t=0,n=e.length;n>t;t++)i=e[t],null!=i.data&&s.push(i);return s}.call(this)),null!=(null!=(l=this.title)?l.data:void 0)&&e.push(this.title),e.length>0){for(t+="\n",n=[],o=0,r=e.length;r>o;o++)s=e[o],a=s.toBBCode(),null!=a&&n.push(a);t+=n.join("\n")}return t},t.prototype.toXML=function(){var t,n,i,e,s,o,r,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k,q,x;for(i=this.effectiveStats(),n="\n    <Actions>",_=i.actions,c=0,p=_.length;p>c;c++)t=_[c],n+="\n       <Action>"+t+"</Action>";if(n+="\n   </Actions>",e=$("<div>").html(this.pilot.text),e.find("br").replaceWith("\n"),e.find('img[alt="Focus"]').replaceWith("Focus"),e.find('img[alt="Evade"]').replaceWith("Evade"),e.find('img[alt="Hit"]').replaceWith("Hit"),e.find('img[alt="Crit"]').replaceWith("Crit"),e.find('img[alt="Turn Right"]').replaceWith("Turn Right"),e.find('img[alt="Turn Left"]').replaceWith("Turn Left"),e.find('img[alt="Bank Right"]').replaceWith("Bank Right"),e.find('img[alt="Bank Left"]').replaceWith("Bank Left"),e.find('img[alt="Straight"]').replaceWith("Straight"),e.find('img[alt="Barrel Roll"]').replaceWith("Barrel Roll"),e.find('img[alt="Boost"]').replaceWith("Boost"),e.find('img[alt="Target Lock"]').replaceWith("Target Lock"),e.find('img[alt="Torpedo"]').replaceWith("Torpedo"),d=$.trim("<Ship>\n    <Faction>"+this.pilot.faction+"</Faction>\n    <Type>"+this.data.name+"</Type>\n    <Pilot>"+this.pilot.name+"</Pilot>\n    <Points>"+this.pilot.points+"</Points>\n    <Score>"+a(this.pilot.skill,i,"skill")+"</Score>\n    <Attack>"+a(null!=(m=null!=(g=this.pilot.ship_override)?g.attack:void 0)?m:this.data.attack,i,"attack")+"</Attack>\n    <Agility>"+a(null!=(v=null!=(b=this.pilot.ship_override)?b.agility:void 0)?v:this.data.agility,i,"agility")+"</Agility>\n    <Shields>"+a(null!=(y=null!=(w=this.pilot.ship_override)?w.shields:void 0)?y:this.data.shields,i,"shields")+"</Shields>\n    <Hull>"+a(null!=(k=null!=(q=this.pilot.ship_override)?q.hull:void 0)?k:this.data.hull,i,"hull")+"</Hull>\n    <Text>"+e.text()+"</Text>"),d+=n,o=function(){var t,n,i,e;for(i=this.upgrades,e=[],t=0,n=i.length;n>t;t++)r=i[t],null!=r.data&&e.push(r);return e}.call(this).concat(function(){var t,n,i,e;for(i=this.modifications,e=[],t=0,n=i.length;n>t;t++)s=i[t],null!=s.data&&e.push(s);return e}.call(this)),null!=(null!=(x=this.title)?x.data:void 0)&&o.push(this.title),o.length>0){for(d+="\n",u=[],h=0,f=o.length;f>h;h++)r=o[h],l=r.toXML(),null!=l&&u.push(l);d+=u.join("\n"),d+="\n</Ship>"}return d},t.prototype.toSerialized=function(){var t,n,i,e,s,a,o,l,d,u,c,h,p,f,_,m,g,v;if(i=null!=(d=null!=(u=this.title)?u.conferredAddons:void 0)?d:[],a=""+function(){var t,n,a,o,l,d;for(a=this.upgrades,d=[],e=t=0,n=a.length;n>t;e=++t)s=a[e],r.call(i,s)<0&&d.push(null!=(o=null!=s?null!=(l=s.data)?l.id:void 0:void 0)?o:-1);return d}.call(this),n=[],(null!=(c=this.title)?c.conferredAddons:void 0)&&this.title.conferredAddons.length>0)for(h=this.title.conferredAddons,o=0,l=h.length;l>o;o++)t=h[o],n.push(t.toSerialized());return[this.pilot.id,a,null!=(p=null!=(f=this.title)?null!=(_=f.data)?_.id:void 0:void 0)?p:-1,null!=(m=null!=(g=this.modifications[0])?null!=(v=g.data)?v.id:void 0:void 0)?m:-1,n.join(",")].join(":")},t.prototype.fromSerialized=function(t,i){var e,s,a,o,r,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k,q,x,S,$,I,B,C,z;switch(t){case 1:for(x=i.split(":"),c=x[0],_=x[1],p=x[2],h=x[3],u=x[4],this.setPilotById(parseInt(c)),S=_.split(","),d=m=0,y=S.length;y>m;d=++m)f=S[d],f=parseInt(f),f>=0&&this.upgrades[d].setById(f);if(p=parseInt(p),p>=0&&this.title.setById(p),null!=this.title&&this.title.conferredAddons.length>0)for($=h.split(","),d=g=0,w=$.length;w>g;d=++g)f=$[d],f=parseInt(f),f>=0&&this.title.conferredAddons[d].setById(f);u=parseInt(u),u>=0&&this.modifications[0].setById(u);break;case 2:for(I=i.split(":"),c=I[0],_=I[1],p=I[2],u=I[3],l=I[4],this.setPilotById(parseInt(c)),B=_.split(","),d=v=0,k=B.length;k>v;d=++v)f=B[d],f=parseInt(f),f>=0&&this.upgrades[d].setById(f);if(p=parseInt(p),p>=0&&this.title.setById(p),u=parseInt(u),u>=0&&this.modifications[0].setById(u),null!=this.title&&this.title.conferredAddons.length>0)for(C=l.split(","),d=b=0,q=C.length;q>b;d=++b){if(r=C[d],z=r.split("."),a=z[0],s=z[1],s=parseInt(s),e=n[a],o=this.title.conferredAddons[d],!(o instanceof e))throw"Expected addon class "+e.constructor.name+" for conferred addon at index "+d+" but "+o.constructor.name+" is there";o.setById(s)}}return this.updateSelections()},t.prototype.effectiveStats=function(){var t,n,i,e,s,a,o,r,l,d,u,c,h,p,f,_,m,g,v,b,y,w,k;for(n={skill:this.pilot.skill,attack:null!=(r=null!=(l=this.pilot.ship_override)?l.attack:void 0)?r:this.data.attack,energy:null!=(_=null!=(m=this.pilot.ship_override)?m.energy:void 0)?_:this.data.energy,agility:null!=(g=null!=(v=this.pilot.ship_override)?v.agility:void 0)?g:this.data.agility,hull:null!=(b=null!=(y=this.pilot.ship_override)?y.hull:void 0)?b:this.data.hull,shields:null!=(w=null!=(k=this.pilot.ship_override)?k.shields:void 0)?w:this.data.shields,actions:this.data.actions.slice(0)},d=this.upgrades,e=0,a=d.length;a>e;e++)i=d[e],null!=(null!=i?null!=(u=i.data)?u.modifier_func:void 0:void 0)&&i.data.modifier_func(n);for(null!=(null!=(c=this.title)?null!=(h=c.data)?h.modifier_func:void 0:void 0)&&this.title.data.modifier_func(n),p=this.modifications,s=0,o=p.length;o>s;s++)t=p[s],null!=(null!=t?null!=(f=t.data)?f.modifier_func:void 0:void 0)&&t.data.modifier_func(n);return n},t.prototype.validate=function(){var t,n,i,e,s,a,o,r,l,d,u,c,h,p,f,_,m,g,v;for(n=32,t=a=0;n>=0?n>=a:a>=n;t=n>=0?++a:--a){for(s=!0,u=this.upgrades,o=0,l=u.length;l>o;o++)if(e=u[o],null!=(null!=e?null!=(c=e.data)?c.restriction_func:void 0:void 0)&&!(null!=e?null!=(h=e.data)?h.restriction_func(this):void 0:void 0)){e.setById(null),s=!1;break}if(null==(null!=(p=this.title)?null!=(f=p.data)?f.restriction_func:void 0:void 0)||(null!=(_=this.title)?null!=(m=_.data)?m.restriction_func(this):void 0:void 0)){for(g=this.modifications,r=0,d=g.length;d>r;r++)if(i=g[r],null!=(null!=i?null!=(v=i.data)?v.restriction_func:void 0:void 0)&&!i.data.restriction_func(this)){i.setById(null),s=!1;break}if(s)break}else this.title.setById(null)}return this.updateSelections()},t}(),t=function(){function t(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.conferredAddons=[],this.serialization_code="X",this.type=null,this.dataByName=null,this.dataById=null}return t.prototype.destroy=function(){var t,n,i,e,s;s=__iced_k_noop,i=iced.findDeferral(arguments),n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],function(t){return function(n){var s;return null==(null!=(s=t.data)?s.unique:void 0)?n():(!function(n){e=new iced.Deferrals(n,{parent:i,filename:"coffeescripts/xwing.coffee",funcname:"GenericAddon.destroy"}),t.ship.builder.container.trigger("xwing:releaseUnique",[t.data,t.type,e.defer({lineno:1538})]),e._fulfill()}(n),void 0)}}(this)(function(i){return function(){return i.selector.select2("destroy"),n(t)}}(this))},t.prototype.setupSelector=function(t){return this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.container.append(this.selector),$.isMobile()&&(t.minimumResultsForSearch=-1),this.selector.select2(t),this.selector.on("change",function(t){return function(){return t.setById(t.selector.select2("val")),t.ship.builder.current_squad.dirty=!0,t.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),t.ship.builder.backend_status.fadeOut("slow")}}(this)),this.selector.data("select2").results.on("mousemove-filtered",function(t){return function(n){var i;return i=$(n.target).closest(".select2-result-selectable").data("select2-data"),null!=(null!=i?i.id:void 0)?t.ship.builder.showTooltip("Addon",t.dataById[i.id]):void 0}}(this)),this.selector.data("select2").container.on("mouseover",function(t){return function(){return null!=t.data?t.ship.builder.showTooltip("Addon",t.data):void 0}}(this))},t.prototype.setById=function(t){return this.setData(this.dataById[parseInt(t)])},t.prototype.setByName=function(t){return this.setData(this.dataByName[$.trim(t)])},t.prototype.setData=function(t){var n,i,e;return e=__iced_k_noop,n=iced.findDeferral(arguments),t===this.data?e():(!function(t){return function(e){var s;return null==(null!=(s=t.data)?s.unique:void 0)?e():(!function(e){i=new iced.Deferrals(e,{parent:n,filename:"coffeescripts/xwing.coffee",funcname:"GenericAddon.setData"}),t.ship.builder.container.trigger("xwing:releaseUnique",[t.data,t.type,i.defer({lineno:1568})]),i._fulfill()}(e),void 0)}}(this)(function(s){return function(){s.rescindAddons(),function(e){return null==(null!=t?t.unique:void 0)?e():(!function(e){i=new iced.Deferrals(e,{parent:n,filename:"coffeescripts/xwing.coffee",funcname:"GenericAddon.setData"}),s.ship.builder.container.trigger("xwing:claimUnique",[t,s.type,i.defer({lineno:1571})]),i._fulfill()}(e),void 0)}(function(){return s.data=t,s.ship.builder.container.trigger("xwing:pointsUpdated"),e(s.conferAddons())})}}(this)),void 0)},t.prototype.conferAddons=function(){var t,n,i,e,a,o,r,l;if(null!=(null!=(o=this.data)?o.confersAddons:void 0)&&this.data.confersAddons.length>0){for(r=this.data.confersAddons,l=[],e=0,a=r.length;a>e;e++){if(t=r[e],i=t.type,n={ship:this.ship,container:this.container},null!=t.slot&&(n.slot=t.slot),t=new i(n),t instanceof s.Upgrade)this.ship.upgrades.push(t);else{if(!(t instanceof s.Modification))throw"Unexpected addon type for addon "+t;this.ship.modifications.push(t)}l.push(this.conferredAddons.push(t))}return l}},t.prototype.rescindAddons=function(){var t,n,i,e;e=__iced_k_noop,n=iced.findDeferral(arguments),function(e){return function(s){var a,o,r;for(i=new iced.Deferrals(s,{parent:n,filename:"coffeescripts/xwing.coffee",funcname:"GenericAddon.rescindAddons"}),r=e.conferredAddons,a=0,o=r.length;o>a;a++)t=r[a],t.destroy(i.defer({lineno:1596}));i._fulfill()}}(this)(function(n){return function(){var i,e,a;for(a=n.conferredAddons,i=0,e=a.length;e>i;i++)if(t=a[i],t instanceof s.Upgrade)n.ship.upgrades.removeItem(t);else{if(!(t instanceof s.Modification))throw"Unexpected addon type for addon "+t;n.ship.modifications.removeItem(t)}return n.conferredAddons=[]}}(this))},t.prototype.getPoints=function(){var t,n;return null!=(t=null!=(n=this.data)?n.points:void 0)?t:0},t.prototype.updateSelection=function(){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+this.data.name+" ("+this.data.points+")"}):this.selector.select2("data",null)},t.prototype.toString=function(){return null!=this.data?""+this.data.name+" ("+this.data.points+")":"No "+this.type},t.prototype.toHTML=function(){return null!=this.data?$.trim('<div class="upgrade-container">\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle upgrade-points">'+this.data.points+'</div>\n        </div>\n    </div>\n    <div class="upgrade-name">'+this.data.name+"</div>\n</div>"):""},t.prototype.toTableRow=function(){return null!=this.data?$.trim('<tr class="simple-addon">\n    <td class="name">'+this.data.name+'</td>\n    <td class="points">'+this.data.points+"</td>\n</tr>"):""},t.prototype.toBBCode=function(){return null!=this.data?"[i]"+this.data.name+" ("+this.data.points+")[/i]":null},t.prototype.toXML=function(){var t;return t=$("<div>").html(this.data.text),t.find("br").replaceWith("\n"),t.find('img[alt="Focus"]').replaceWith("Focus"),t.find('img[alt="Evade"]').replaceWith("Evade"),t.find('img[alt="Hit"]').replaceWith("Hit"),t.find('img[alt="Crit"]').replaceWith("Crit"),t.find('img[alt="Turn Right"]').replaceWith("Turn Right"),t.find('img[alt="Turn Left"]').replaceWith("Turn Left"),t.find('img[alt="Bank Right"]').replaceWith("Bank Right"),t.find('img[alt="Bank Left"]').replaceWith("Bank Left"),t.find('img[alt="Straight"]').replaceWith("Straight"),t.find('img[alt="Barrel Roll"]').replaceWith("Barrel Roll"),t.find('img[alt="Boost"]').replaceWith("Boost"),t.find('img[alt="Target Lock"]').replaceWith("Target Lock"),t.find('img[alt="Torpedo"]').replaceWith("Torpedo"),null!=this.data?" \n<Addon>\n    <Type>"+this.data.type+"</Type>\n    <Name>"+this.data.name+"</Name>\n    <Points>"+this.data.points+"</Points>\n    <Text>"+t.text()+"</Text>\n</Addon>":null
},t.prototype.toSerialized=function(){var t,n;return""+this.serialization_code+"."+(null!=(t=null!=(n=this.data)?n.id:void 0)?t:-1)},t}(),s.Upgrade=function(t){function n(t){n.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=s.upgradesById,this.dataByName=s.upgrades,this.serialization_code="U",this.setupSelector()}return u(n,t),n.prototype.setupSelector=function(){return n.__super__.setupSelector.call(this,{width:"50%",placeholder:s.translate(this.ship.builder.language,"ui","upgradePlaceholder",this.slot),allowClear:!0,query:function(t){return function(n){return n.callback({more:!1,results:t.ship.builder.getAvailableUpgradesIncluding(t.slot,t.data,n.term)})}}(this)})},n}(t),s.Modification=function(t){function n(t){n.__super__.constructor.call(this,t),this.type="Modification",this.dataById=s.modificationsById,this.dataByName=s.modifications,this.serialization_code="M",this.setupSelector()}return u(n,t),n.prototype.setupSelector=function(){return n.__super__.setupSelector.call(this,{width:"50%",placeholder:s.translate(this.ship.builder.language,"ui","modificationPlaceholder"),allowClear:!0,query:function(t){return function(n){return n.callback({more:!1,results:t.ship.builder.getAvailableModificationsIncluding(t.data,t.ship,n.term)})}}(this)})},n}(t),s.Title=function(t){function n(t){n.__super__.constructor.call(this,t),this.type="Title",this.dataById=s.titlesById,this.dataByName=s.titles,this.serialization_code="T",this.setupSelector()}return u(n,t),n.prototype.setupSelector=function(){return n.__super__.setupSelector.call(this,{width:"50%",placeholder:s.translate(this.ship.builder.language,"ui","titlePlaceholder"),allowClear:!0,query:function(t){return function(n){return n.callback({more:!1,results:t.ship.builder.getAvailableTitlesIncluding(t.ship,t.data,n.term)})}}(this)})},n}(t),n={M:s.Modification,T:s.Title,U:s.Upgrade}}).call(this);
//@ sourceMappingURL=xwing.min.map